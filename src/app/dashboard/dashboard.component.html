<div class="row mt-3">
  <div class="col-md-10"><h2>Dashboard</h2></div>
  <div class="col-md-2"><button class="btn btn-link" style="float: right" (click)="logout()">Logout</button></div>
</div>

<app-structure-selector (onSelect)="structureSelected($event)"></app-structure-selector>

<div *ngIf="!structureId" class="alert alert-warning mb-3">Please select a structure that you have access to first. Currently it has to be a citadel. The search is not strict, you can use 'ge sota factory' to search for GE-8JV - SOTA FACTORY.</div>
<div *ngIf="structureId">
<p *ngIf="!itemWatches">Loading ...</p>
<p *ngIf="itemWatches && itemWatches.length === 0">You haven't defined any thresholds for this structure yet.</p>
<p *ngIf="itemWatches && itemWatches.length > 0">You will receive notifications for the following thresholds:</p>
<table class="table" *ngIf="itemWatches">
  <tbody>
  <tr>
    <td>
      <input type="text" class="form-control" [class.is-invalid]="suggestionSearchFailed" [(ngModel)]="selected"
             [ngbTypeahead]="search" placeholder="Item name or evepraisal link"/>
    </td>
    <td>
      <input *ngIf="!selected || !selected.includes('evepraisal')" type="number" class="form-control"
             [(ngModel)]="threshold" placeholder="Threshold"/>
      <div *ngIf="selected && selected.includes('evepraisal')">Thresholds are taken from the evepraisal quantities and will <b>override</b> existing entries.</div>
    </td>
    <td>
      <button class="btn btn-primary" *ngIf="!submitting && !searching" (click)="submitItemWatch()">+</button>
      <div class="invalid-feedback" *ngIf="suggestionSearchFailed">Sorry, suggestions could not be loaded.</div>
      <div class="alert alert-info" *ngIf="submitting" >Processing ...</div>
      <div class="alert alert-info" *ngIf="searching" >Searching ...</div>
      <div class="alert alert-danger" *ngIf="notFound">The item could not be found. Is there a typo?</div>
      <div class="alert alert-warning" *ngIf="alreadyPresent">The item is already present.<br/>Please delete the existing entry first.</div>
    </td>
  </tr>
  <tr *ngFor="let watch of itemWatches">
    <td class="align-middle"><img src="https://image.eveonline.com/Type/{{watch['typeId']}}_64.png" style="margin-right: 10px;"/>
      {{watch['typeName']}}</td>
    <td>{{watch['threshold'] | number:'1.0-2'}}</td>
    <td class="align-middle"><button (click)="delete(watch['id'])" type="button" class="btn btn-danger">x</button></td>
  </tr>
  </tbody>
</table>
</div>

<hr/>
<app-danger-zone></app-danger-zone>
